# THIS IS A CYLC TASK DEFINITION FILE

%TASK
    ext_get_dump_ukmet, e_g_d_uk

%DESCRIPTION
    Get the UK MetOffice T+3 dump file. This task is only used during an
    initial coldstart, and thereafter should be inserted when needed.

%TYPE
    free, oneoff

%OWNER
    ecoconnect

%HOURS
    0,6,12,18

%ENVIRONMENT
    PREV_CYCLE_TIME   $( cylcutil cycle-time -s 6 )
    HH  ${PREV_CYCLE_TIME:8:2}
    SRCE    ftpops.metoffice.gov.uk
    SRCE_LOC    ~/
    DEST_LOC    ${HOME}/output
    FILENAME    qwqg${HH}.reduced.${PREV_CYCLE_TIME}.T+3.gz
    SRCE_USER   niwa
    SERVICE     ext_get_dump_ukmet
    KEEP    1
    FAST    1
    FILEOUT $FILENAME
    TIMEOUT 45
    CHECKSUM    0
    CHECKFILE   None

%COMMAND
    cylc-wrapper file_transfer_ftp.sh
                                
%PREREQUISITES
    "UM global $(CYCLE_TIME -6) start dump file available for download"

%OUTPUTS
    "UM global $(CYCLE_TIME -6) start dump downloaded"
