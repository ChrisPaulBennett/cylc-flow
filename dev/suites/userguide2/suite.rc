
title = MODIFIED cylc userguide example suite

description = """This suite can be used for testing cylc features. See
the unmodified userguide example suite for a clear exposition of cylc
suite basics."""

task submitted hook         = alert.sh
task started hook           = alert.sh
task finished hook          = alert.sh
task failed hook            = alert.sh
task warning hook           = alert.sh
task submission failed hook = alert.sh

task timeout hook           = timeout.sh
task submission timeout minutes = 0.1
use secure passphrase = True
use lockserver = False

#use crude safety lock = True
#ignore task owners = True
#job submission method = ll_basic
job submission log directory = logs

exclude task list = baz,

[task families]
FOO = foo, bar

[dependency graph] #----------------------------------------------------
#        > B => E
#       /   \
# X => A     => D  (plus various modifications...)
#       \   /
#        > C => F

    [[ 0,6,12,18 ]]
    label1  =  X ===> A ===> B ===>  E
    label2  =  A ===> C ===> F:1 ===> FOO ===> postfoo
    label3  =  B & C ===> D

    # family: internal dependencies
    labelfam = foo ===> bar
    
    labelc1 = ColdA| =m=> A
    labelc2 = ColdB| =m=> B
    labelc3 = ColdC| =m=> C

    labelx1 = startup =c=> X & ColdA & ColdB & ColdC
    labelx2 = F ===> baz|

    # TO DO, conditional triggers:
    # label99 = (B or C) ===> D

    [[ 6,18 ]]
    label6 = E ===> H

    [[ 0,12 ]]
    label7 = E(T-6)===> H
    label8 = F(T-6):1 ===> G

[environment] #--------------------------------------------------
WORKSPACE = /tmp/$USER/$CYLC_SUITE_NAME
TASK_EXE_SECONDS = 10 
A_RUNNING_DIR = $WORKSPACE/RunningA
B_RUNNING_DIR = $WORKSPACE/RunningB
C_RUNNING_DIR = $WORKSPACE/RunningC
# quotes required because of the '#' character:
A_SHELL_PARAMETER_EXPANSION="${WORKSPACE##_.*}"

[ tasks ]
    [[startup]] #------------------------------------------------------
    #owner = munge
    command list = cylc-wrapper clean-workspace.sh $WORKSPACE,
    log file list = foo, bar, baz
        [[[directives]]]
        FOO = BAR
        MUNGE = FLUNGE

    [[X]] #------------------------------------------------------
    type modifier list = clock(offset = 1 hour), sequential,
    command list = cylc-wrapper X.sh,
    scripting = """
echo hello
mkdir /tmp/munge
echo bye"""
        [[[ environment ]]]
        X_OUTPUT_DIR = $WORKSPACE
 
    [[A]] #------------------------------------------------------
    type modifier list = model(restarts = 3),
    command list = cylc-wrapper A.sh,
        [[[environment]]]
        A_INPUT_DIR = $WORKSPACE
        A_OUTPUT_DIR = $WORKSPACE
%include common/common-env.inc

    [[B]] #------------------------------------------------------
    type modifier list = model(restarts = 3),
    command list = cylc-wrapper B.sh,
        [[[environment]]]
        B_INPUT_DIR = $WORKSPACE
        B_OUTPUT_DIR = $WORKSPACE
#include common/common-env.inc

    [[C]] #------------------------------------------------------
    type modifier list = model(restarts = 3),
    command list = cylc-wrapper C.sh,
        [[[environment]]]
        C_INPUT_DIR = $WORKSPACE
        C_OUTPUT_DIR = $WORKSPACE
#include common/common-env.inc

    [[D]] #------------------------------------------------------
    execution timeout minutes = 0.1
    #reset execution timeout on incoming messages = False
    command list = D-no-wrap.sh,
    #command list = cylc-wrapper D.sh,
    #command list = cylc-wrapper D-fail.sh, cylc-wrapper D.sh,
    # job submission method = ll_basic
        [[[environment]]]
        D_INPUT_DIR = $WORKSPACE
        D_OUTPUT_DIR = $WORKSPACE
 
    [[E]] #------------------------------------------------------
    command list = cylc-wrapper E.sh,
        [[[environment]]]
        E_INPUT_DIR = $WORKSPACE
        E_OUTPUT_DIR = $WORKSPACE
 
    [[F]] #------------------------------------------------------
    command list = cylc-wrapper F.sh,
        [[[outputs]]]
        1 = "foo products ready for $(CYCLE_TIME)"
        [[[environment]]]
        F_INPUT_DIR = $WORKSPACE
        F_OUTPUT_DIR = $WORKSPACE

    [[G]] #------------------------------------------------------
    command list = cylc-wrapper G.sh,
        [[[environment]]]
        G_INPUT_DIR = $WORKSPACE
        G_OUTPUT_DIR = $WORKSPACE

    [[ColdA]] #------------------------------------------------
    description = "fulfils restart dependencies for model A"
    command list = cylc-wrapper ColdA.sh,

    [[ColdB]] #------------------------------------------------
    description = "fulfils restart dependencies for model B"
    command list = cylc-wrapper ColdB.sh,

    [[ColdC]] #------------------------------------------------
    description = "fulfils restart dependencies for model C"
    command list = cylc-wrapper ColdC.sh,

    [[foo]] #--------------------------------------------------
    [[bar]] #--------------------------------------------------
    [[baz]] #--------------------------------------------------
    [[postfoo]] #----------------------------------------------
    [[FOO]] #--------------------------------------------------
    [[H]]
    [[I]]

[taskdefs]
    [[slunge]]
    description = """a task that commits suicide if B finishes"""
    cycles = 0,6,12,18
        [[[ prerequisites ]]]
        a = C%$(CYCLE_TIME) finished
        [[[ suicide prerequisites ]]]
        a = B%$(CYCLE_TIME) finished

    [[munge]]
    #owner = superman
    description = testing testing testing
    cycles = 0,6,12,18
        [[[outputs]]]
        a = munge one products ready for $(CYCLE_TIME)
        b = munge two products ready for $(CYCLE_TIME)
        [[[prerequisites]]]
        a = C%$(CYCLE_TIME) finished
        b = D%$(CYCLE_TIME) finished
        condition = (a or b)
            [[[[ 6,18 ]]]]
            c = F%$(CYCLE_TIME) finished
