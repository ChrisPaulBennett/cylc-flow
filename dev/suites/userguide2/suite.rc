
title = MODIFIED cylc userguide example suite

description = """This suite can be used for testing cylc features. See
the unmodified userguide example suite for a clear exposition of cylc
suite basics."""

task submitted hook         = alert.sh
task started hook           = alert.sh
task finished hook          = alert.sh
task failed hook            = alert.sh
task warning hook           = alert.sh
task submission failed hook = alert.sh

task timeout hook           = timeout.sh
task submission timeout minutes = 0.1
use secure passphrase = True
use lockserver = True

#use crude safety lock = True
#ignore task owners = True
#job submission method = ll_basic
job submission log directory = running/${CYLC_SUITE_NAME}-logs

exclude task list = baz,

[task families]
FOO = foo, bar

[dependencies] #----------------------------------------------------
#        > B => E
#       /   \
# X => A     => D  (plus various modifications...)
#       \   /
#        > C => F

    [[ 0,6,12,18 ]]
        graph  = """
        X => A => B =>  E
        ###A => C => F:1 => FOO => postfoo
        A => C => F => FOO => postfoo
        B & C => D

    # family: internal dependencies
       foo => bar
    
    ColdA | A(T-6) => A
    ColdB | B(T-6) => B
    ColdC | C(T-6) => C

    #### startup =c=> X & ColdA & ColdB & ColdC
    F => baz
    """

    [[ 6,18 ]]
        graph = E => H

    [[ 0,12 ]]
        graph = """
        E(T-6)=> H
        ###F(T-6):1 => G
        """

[environment] #--------------------------------------------------
WORKSPACE = /tmp/$USER/$CYLC_SUITE_NAME
TASK_EXE_SECONDS = 10 
A_RUNNING_DIR = $WORKSPACE/RunningA
B_RUNNING_DIR = $WORKSPACE/RunningB
C_RUNNING_DIR = $WORKSPACE/RunningC
# quotes required because of the '#' character:
A_SHELL_PARAMETER_EXPANSION="${WORKSPACE##_.*}"

[ tasks ]
    [[startup]] #------------------------------------------------------
    #owner = munge
    list of commands = cylc-wrapper clean-workspace.sh $WORKSPACE,
    log file list = foo, bar, baz
        [[[directives]]]
        FOO = BAR
        MUNGE = FLUNGE

    [[X]] #------------------------------------------------------
    type modifier list = clock(offset = 1 hour), sequential,
    list of commands = cylc-wrapper X.sh,
    scripting = """
echo hello
mkdir /tmp/munge
echo bye"""
        [[[ environment ]]]
        X_OUTPUT_DIR = $WORKSPACE
 
    [[A]] #------------------------------------------------------
    type modifier list = model(restarts = 3),
    list of commands = cylc-wrapper A.sh,
        [[[environment]]]
        A_INPUT_DIR = $WORKSPACE
        A_OUTPUT_DIR = $WORKSPACE
%include common/common-env.inc

    [[B]] #------------------------------------------------------
    type modifier list = model(restarts = 3),
    list of commands = cylc-wrapper B.sh,
        [[[environment]]]
        B_INPUT_DIR = $WORKSPACE
        B_OUTPUT_DIR = $WORKSPACE
#include common/common-env.inc

    [[C]] #------------------------------------------------------
    type modifier list = model(restarts = 3),
    list of commands = cylc-wrapper C.sh,
        [[[environment]]]
        C_INPUT_DIR = $WORKSPACE
        C_OUTPUT_DIR = $WORKSPACE
#include common/common-env.inc

    [[D]] #------------------------------------------------------
    execution timeout minutes = 0.1
    #reset execution timeout on incoming messages = False
    list of commands = D-no-wrap.sh,
    #list of commands = cylc-wrapper D.sh,
    #list of commands = cylc-wrapper D-fail.sh, cylc-wrapper D.sh,
    # job submission method = ll_basic
        [[[environment]]]
        D_INPUT_DIR = $WORKSPACE
        D_OUTPUT_DIR = $WORKSPACE
 
    [[E]] #------------------------------------------------------
    list of commands = cylc-wrapper E.sh,
        [[[environment]]]
        E_INPUT_DIR = $WORKSPACE
        E_OUTPUT_DIR = $WORKSPACE
 
    [[F]] #------------------------------------------------------
    list of commands = cylc-wrapper F.sh,
        [[[outputs]]]
        1 = "foo products ready for $(CYCLE_TIME)"
        [[[environment]]]
        F_INPUT_DIR = $WORKSPACE
        F_OUTPUT_DIR = $WORKSPACE

    [[G]] #------------------------------------------------------
    list of commands = cylc-wrapper G.sh,
        [[[environment]]]
        G_INPUT_DIR = $WORKSPACE
        G_OUTPUT_DIR = $WORKSPACE

    [[ColdA]] #------------------------------------------------
    description = "fulfils restart dependencies for model A"
    list of commands = cylc-wrapper ColdA.sh,

    [[ColdB]] #------------------------------------------------
    description = "fulfils restart dependencies for model B"
    list of commands = cylc-wrapper ColdB.sh,

    [[ColdC]] #------------------------------------------------
    description = "fulfils restart dependencies for model C"
    list of commands = cylc-wrapper ColdC.sh,

    [[foo]] #--------------------------------------------------
    [[bar]] #--------------------------------------------------
    [[baz]] #--------------------------------------------------
    [[postfoo]] #----------------------------------------------
    [[FOO]] #--------------------------------------------------
    [[H]]
    [[I]]
