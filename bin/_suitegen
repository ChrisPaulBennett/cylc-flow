#!/usr/bin/env python

import re
import taskdef

graph = [
"A -> B ->  E",
"A -> C ->F",
"B -> D",
"C -> D"
]

names = []
suite = []
for line in graph:
    sequence = re.split( '\s*->\s*', line )
    count = 0
    tasks = []
    for name in sequence:
        if name not in names:
            names.append( name )
            task = taskdef.taskdef()
            print "Appending", name
            tasks.append( task )
            task.name = name
            task.logfiles = []
            task.commands['any'] = [ "cylc-wrapper echo hello" ]
            task.hours = [ 0,6,12,18 ]
            task.type = 'free'
            task.outputs['any'] = [ name + " output 1 ready for $(CYCLE_TIME)" ]

            if count > 0:
                task.prerequisites['any'] = [ tasks[count-1].name + " output 1 ready for $(CYCLE_TIME)" ]
            
            count += 1

    suite.extend( tasks )

for task in suite:
    print task.name
    FILE = open( task.name + '.def', 'w' )
    task.dump( FILE )
    FILE.close()

