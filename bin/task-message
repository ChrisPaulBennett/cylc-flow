#!/bin/bash

# trivial wrapper for task-message.py

# USAGE: task_message <PRIORITY> <"MESSAGE">
# priorities are CRITICAL, WARNING, NORMAL

# $REFERENCE_TIME and $TASK_MESSAGE required from env

# If MESSAGE is 'started', 'finished', or 'failed'
# task name and reference time are added automatically


if [[ -z $REFERENCE_TIME ]]; then
    echo "task-message ERROR: \$REFERENCE_TIME not defined"
    exit 1
fi

if [[ -z $TASK_NAME ]]; then
    echo "task-message ERROR: \$TASK_NAME not defined"
    exit 1
fi

MESSAGER=task-message.py
#MESSAGER=echo   # debugging

PRIORITY=$1; shift
MESSAGE="$@"

# special cases
if [[ $MESSAGE = 'started' || $MESSAGE = 'finished' || $MESSAGE = 'failed' ]]; then 
    MESSAGE="$TASK_NAME $MESSAGE for $REFERENCE_TIME"
fi

$MESSAGER $PRIORITY $TASK_NAME $REFERENCE_TIME "$MESSAGE"
