#!/usr/bin/env python

import gtk
import os, re, sys
from warning_dialog import warning_dialog, info_dialog
import subprocess

"""Run a command as a subprocess and capture the resulting stdout and
stderr to display in a dialog. Examples:
    $ capture "echo foo"
    $ capture "echo foo; echo bar" &
"""

class info(object):
    def __init__( self, stdout, stderr, command ):
        self.window = gtk.Window(gtk.WINDOW_TOPLEVEL)
        #self.window.set_size_request(200, 200)
        self.window.set_border_width( 5 )
        self.window.connect("delete_event", self.quit)
        vbox = gtk.VBox()
        msg = command
        if stdout != '':
            msg += '\n\nstdout:\n' + stdout
        if stderr != '':
            msg += '\n\nstderr:\n' + stderr
        label = gtk.Label( msg )
        vbox.pack_start(label)
        ok_button = gtk.Button( "OK" )
        ok_button.connect("clicked", self.quit, None, None )
        vbox.pack_start(ok_button)
        self.window.add(vbox)
        self.window.show_all()

    def quit( self, w, e, data=None ):
        gtk.main_quit()

if __name__ == '__main__':
    command_list = sys.argv[1:]
    command = ' '.join( command_list )
    p = subprocess.Popen( command_list,
            stdout=subprocess.PIPE, stderr=subprocess.PIPE, shell=True )
    p.wait()
    stdout, stderr = p.communicate()
    if stdout != '' or stderr != '':
        info( stdout, stderr, command )
        gtk.main()
