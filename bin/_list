#!/usr/bin/env python

#         __________________________
#         |____C_O_P_Y_R_I_G_H_T___|
#         |                        |
#         |  (c) NIWA, 2008-2010   |
#         | Contact: Hilary Oliver |
#         |  h.oliver@niwa.co.nz   |
#         |    +64-4-386 0461      |
#         |________________________|

import os, sys
from registration import registrations
from optparse import OptionParser

parser = OptionParser( """cylc task-list [options] SUITE

Print the title and task list of a locally registered suite (which 
need not be running - this command accesses suite source files). """ )

parser.add_option( "-o", "--owner", help="suite owner (default $USER).",
        metavar='USERNAME', action="store", default=os.environ['USER'], 
        dest="owner" )

(options, args) = parser.parse_args()

if len(args) != 1:
    parser.error( "Wrong number or arguments" )
else:
    suite = args[0]

# find location of the suite task and config modules
reg = registrations( options.owner )
if reg.is_registered( suite ):
    suite_dir = reg.get( suite )
    reg.print_reg( suite )
else:
    print >> sys.stderr, "ERROR: suite " + suite + " is not registered"
    reg.print_all()
    sys.exit(1)

# provide access to the suite source modules for THIS program
sys.path.append( os.path.join( suite_dir, 'configured' ))
from task_list import task_list
for task in task_list:
    print ' ', task
