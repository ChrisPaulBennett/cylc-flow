#!/usr/bin/env python


import os, sys, re
import socket
from optparse import OptionParser
from port_scan import scan

parser = OptionParser( """cylc [discover] scan [options]
    
Scan cylc ports for running suites and lockservers. Connection Denied
indicates a secure suite owned by somebody else.""" )

parser.add_option( "--host",
        help="Cylc suite host (defaults to localhost).",
        metavar="HOST", action="store", default=socket.getfqdn(),
        dest="host" )

parser.add_option( "--print-ports",
        help="Print cylc's configured port range.",
        action="store_true",default=False, dest="print_ports" )

( options, args ) = parser.parse_args()

if options.print_ports:
    from cylc_pyro_server import pyro_base_port, pyro_port_range
    print "cylc port range from $CYLC_DIR/src/cylc_pyro_server.py:"
    print pyro_base_port, '<= port <=', pyro_base_port + pyro_port_range
    sys.exit(0)

host = options.host

if len(args) != 0:
    parser.error( "Wrong number of arguments" ) 

suites = scan( host, verbose=True )
