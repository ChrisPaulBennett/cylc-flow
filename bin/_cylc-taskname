#!/usr/bin/perl -w

# extract task name from a cylc taskdef file

# use as a file filter: NAME=$( _cylc-taskname < taskdef.def )

# look for '%NAME' at the start of a line, then 
# ignore any subsequent blank lines, and 
# ignore any subsequent comment lines (possible white space followed by '#')
# => "name[, shortname]" is on the next line 

my $name;
search: while ( my $line = <> ) {
    if ( $line =~ m/%NAME/) {
        while ( my $next_line = <> ) {
            if ( $next_line !~ m/^\s*\#/ && $next_line !~ m/^\s*$/ ) {
                $name = $next_line;
                $name =~ s/,.*$//;
                last search;
            }
        }
    }
}

$name =~ s/\s*//;
chomp( $name );
print $name;
