#!/usr/bin/python

#         __________________________
#         |____C_O_P_Y_R_I_G_H_T___|
#         |                        |
#         |  (c) NIWA, 2008-2010   |
#         | Contact: Hilary Oliver |
#         |  h.oliver@niwa.co.nz   |
#         |    +64-4-386 0461      |
#         |________________________|


from connector import connector
from CylcOptionParsers import PromptOptionParser

parser = PromptOptionParser( """cylc nudge [options] SYSTEM 

Invoke the task processing loop in a running system.

By default cylc enters the main task processing loop only when a task
proxy changes state due to an incoming message, and after certain other
events. If this fails to happen when it should the system will appear to
be "stuck". In the unlikely event that this happens, which implies a
minor bug in cylc that should be fixed, a quick nudge will get the
system going again.""" )

# INVOKING THE LOOP ON A TIMEOUT WOULD BE A FAILSAFE OPTION:
# 'cylc schedule --use-timeout'?

(options, args) = parser.parse_args()

if parser.prompt( 'Nudge' ):
    god = connector( parser.get_pns_host(), parser.get_groupname(), 'remote' ).get()
    god.nudge()
