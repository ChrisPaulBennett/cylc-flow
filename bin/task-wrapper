#!/bin/bash

set -e  # abort on error

trap 'task-message CRITICAL failed' ERR

#   1. $REFERENCE_TIME  
#   2. $TASK_NAME      
#   3. $WRAP          

if [[ -z $REFERENCE_TIME ]]; then
	task-message CRITICAL "REFERENCE_TIME not defined"
	task-message CRITICAL failed 
	exit 1
fi

if [[ -z $TASK_NAME ]]; then
	task-message CRITICAL "TASK_NAME not defined"
	task-message CRITICAL failed 
	exit 1
fi

if [[ -z $WRAP ]]; then
	task-message CRITICAL "WRAP not defined"
	task-message CRITICAL failed 
	exit 1
fi

echo "task-wrapper: calling $TASK_NAME for $REFERENCE_TIME"
task-message NORMAL started

# call the wrapped task
if $WRAP; then 
    # succeeded
    task-message NORMAL finished
else
    # failed
	task-message CRITICAL failed 
fi
