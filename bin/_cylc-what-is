#!/usr/bin/python

#         __________________________
#         |____C_O_P_Y_R_I_G_H_T___|
#         |                        |
#         |  (c) NIWA, 2008-2010   |
#         | Contact: Hilary Oliver |
#         |  h.oliver@niwa.co.nz   |
#         |    +64-4-386 0461      |
#         |________________________|


import sys, re
#import cycle_time
from connector import connector
from CylcOptionParsers import NoPromptOptionParser_u

parser = NoPromptOptionParser_u( usage = """cylc what-is [options] SYSTEM 

Retrieve the description of a running system, or a task proxy object
that exists within a running system. """ )

parser.add_option( "-t", "--task",
        help="Retrieve a task, rather than system, description.",
        metavar="TASK", action="store", dest="task" )

(options, args) = parser.parse_args()
system_name = parser.get_system_name()

god = connector( parser.get_pns_host(), parser.get_groupname(), 'remote' ).get()

if options.task:

    task = options.task
    print
    print task + ' in ' + system_name + ':'

    # retrieve and print task class descriptions
    names = [ task ]

    # strip off cycles time, if given
    names = [ re.sub( '%.*', '', name ) for name in names ]

    info = god.get_task_info( names )

    for name in info.keys():
        print
        for line in info[name]:
            print '  ' + line

else: 
    print
    ( title, sysdef_dir, username, info ) = god.get_sys_info()

    print title
    print ' * ' + username + ': ' + system_name + ' --> ' + sysdef_dir
    for item in info.keys():
        print ' + ' + item + ': ' +  info[item]

print
