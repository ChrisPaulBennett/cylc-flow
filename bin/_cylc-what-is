#!/usr/bin/python

import sys, re
from connectors import connect_to_control

usage = """cylc what-is [options] SYSTEM 

Retrieve the description of a running system, or a task proxy object
that exists within a running system. """

connector = connect_to_control( usage, no_prompt=True )

connector.parser.add_option( "-t", "--task",
        help="Retrieve a task, rather than system, description.",
        metavar="TASK", action="store", dest="task" )

connector.parse_args()

controller = connector.get_control()

if connector.options.task:
    task = connector.options.task
    print
    print task + ' in ' + connector.system_name + ':'

    # retrieve and print task class descriptions
    names = [ task ]

    # strip off cycles time, if given
    names = [ re.sub( '%.*', '', name ) for name in names ]

    info = controller.get_task_info( names )
    for name in info.keys():
        print
        for line in info[name]:
            print '  ' + line
    print

else: 
    print
    print 'System: ' + connector.system_name
    print 'SYSTEM DESCRIPTION NOT YET IMPLEMENTED'
