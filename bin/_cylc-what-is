#!/usr/bin/python

import sys, re
from connector import connector
from CylcOptionParsers import NoPromptOptionParser

parser = NoPromptOptionParser( usage = """cylc what-is [options] SYSTEM 

Retrieve the description of a running system, or a task proxy object
that exists within a running system. """ )

parser.add_option( "-t", "--task",
        help="Retrieve a task, rather than system, description.",
        metavar="TASK", action="store", dest="task" )

(options, args) = parser.parse_args()
system_name = parser.get_system_name()

if options.task:

    god = connector( parser.get_pns_host(), parser.get_groupname(), 'remote' ).get()
 
    task = options.task
    print
    print task + ' in ' + system_name + ':'

    # retrieve and print task class descriptions
    names = [ task ]

    # strip off cycles time, if given
    names = [ re.sub( '%.*', '', name ) for name in names ]

    info = god.get_task_info( names )
    for name in info.keys():
        print
        for line in info[name]:
            print '  ' + line
    print

else: 
    print
    print 'System: ' + system_name
    print 'SYSTEM DESCRIPTION NOT YET IMPLEMENTED'
