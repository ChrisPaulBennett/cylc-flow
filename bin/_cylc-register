#!/usr/bin/python

import os, sys
from optparse import OptionParser
from registration import registrations

parser = OptionParser( usage = """cylc register --sysdef=PATH SYSTEM
Usage: cylc register [-p,--print] [-g,--get]
    
Register a system for use by name.

A running cylc system can only be accessed, with cylc commands, using
the registered name under which it was started up. 

Arguments:
  SYSTEM   Name to associate with the configured system directory.""" )

parser.add_option( "-s", "--sysdef",
    help="Location of a cylc system definition directory.",
    metavar="PATH", action="store", dest="dir" )

parser.add_option( "-p", "--print",
    help="Print all current system registrations.",
    action="store_true", default=False, dest="printall" )

parser.add_option( "-g", "--get",
    help="Print the system directory registered under NAME.",
    metavar="NAME", action="store", dest="get" )

( options, args ) = parser.parse_args()

# load registration file
reg = registrations()
reg.load_from_file()

if options.get:
    # print one registration and exit
    print reg.get( options.get )
    sys.exit(0)

elif options.printall:
    # print current registrations and exit
    reg.print_all()
    sys.exit(0)

elif options.dir:
    # record a new registration for dir
    if len( args ) != 1:
        parser.error( 'system name required' )
    else:
        name = args[0]
        reg.register( name, options.dir )

    reg.dump_to_file()

else:
    parser.error( 'input required' )
