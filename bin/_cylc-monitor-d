#!/bin/bash

# A simple terminal-based monitor to display running dummy tasks
 
print_usage() {
	echo "usage: cylc monitor-d [options]"
    echo ""
    echo "A simple terminal-based monitor to display dummy task programs"
    echo "spawned by any cylc instances running under your username."
    echo ""
	echo "options:"
	echo "  -h, --help    Print this usage message and exit."
}

if [[ $# != 0 ]]; then
	print_usage
	if [[ $1 == '--help' || $1 == '-h' ]]; then
		exit 0
	else
		exit 1
	fi
fi

HEADING1="Cylc External Dummy Tasks Currently Running"
HEADING2=$(ps -fu $USER | grep UID | grep -v grep)

OIFS=$IFS
while true; do
    IFS=$OIFS
    FOO=$(ps -fu $USER | grep dummy | grep -v grep )
    clear
    IFS=$'\n'
    echo -e "\033[31m$HEADING1\033[0m"
    echo -e "\033[34m$HEADING2\033[0m"
    for line in $FOO
        do 
            echo -e "\033[33m$line\033[0m"
        done
    sleep 2
done
